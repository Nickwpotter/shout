import{s as ie,n as J,c as Q,o as ce,r as ue}from"../chunks/scheduler.PCYk-eKx.js";import{S as de,i as fe,e as p,c as h,a as g,d as f,q as r,g as V,w as oe,s as M,k as se,p as G,f as N,A as K,t as R,B as X,b as j,h as c,j as Z,y as Y,r as te}from"../chunks/index.CKmYMgu1.js";import{e as me,c as pe,d as re,u as he,i as be,a as ve,b as le}from"../chunks/firebase.C7CWxqOX.js";import{w as ae}from"../chunks/index.eg0ioKiZ.js";import{p as _e}from"../chunks/stores.CUhjNm-V.js";import{a as ge}from"../chunks/authStore.Cjia8BFJ.js";import{g as z}from"../chunks/entry.Cpyu-pHp.js";function we(i){let e,t="Register Transaction",a,n;function o(s,m){return s[6]?De:ye}let d=o(i),l=d(i);return{c(){e=p("h1"),e.textContent=t,a=M(),l.c(),n=se(),this.h()},l(s){e=h(s,"H1",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-uix1vj"&&(e.textContent=t),a=N(s),l.l(s),n=se(),this.h()},h(){r(e,"class","text-3xl font-bold text-black mb-6")},m(s,m){V(s,e,m),V(s,a,m),l.m(s,m),V(s,n,m)},p(s,m){d===(d=o(s))&&l?l.p(s,m):(l.d(1),l=d(s),l&&(l.c(),l.m(n.parentNode,n)))},d(s){s&&(f(e),f(a),f(n)),l.d(s)}}}function ke(i){let e,t='<div class="card rounded-lg w-96 bg-base-100 shadow-xl"><figure class="px-10 pt-10"><img src="https://plus.unsplash.com/premium_photo-1681487956679-59fb4ffef9b8?q=80&amp;w=1760&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Shoes" class="rounded-xl"/></figure> <div class="card-body items-center text-center"><h2 class="card-title text-white">Transaction Successful!</h2> <p class="text-white">Thanks for working with Shout</p></div></div>';return{c(){e=p("div"),e.innerHTML=t,this.h()},l(a){e=h(a,"DIV",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-9rkt22"&&(e.innerHTML=t),this.h()},h(){r(e,"class","card rounded-lg w-98 p-2 bg-gradient-to-r from-[#833ab4] from-10% via-[#fd1d1d] via-30% to-[#fcb045] to-90%")},m(a,n){V(a,e,n)},p:J,d(a){a&&f(e)}}}function xe(i){let e;return{c(){e=p("span"),this.h()},l(t){e=h(t,"SPAN",{class:!0}),g(e).forEach(f),this.h()},h(){r(e,"class","loading loading-infinity loading-lg text-white")},m(t,a){V(t,e,a)},p:J,d(t){t&&f(e)}}}function ye(i){let e,t,a,n,o,d;return{c(){e=p("div"),t=K("svg"),a=K("path"),n=M(),o=p("span"),d=R(i[7]),this.h()},l(l){e=h(l,"DIV",{role:!0,class:!0});var s=g(e);t=X(s,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var m=g(t);a=X(m,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),g(a).forEach(f),m.forEach(f),n=N(s),o=h(s,"SPAN",{});var y=g(o);d=j(y,i[7]),y.forEach(f),s.forEach(f),this.h()},h(){r(a,"stroke-linecap","round"),r(a,"stroke-linejoin","round"),r(a,"stroke-width","2"),r(a,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),r(t,"xmlns","http://www.w3.org/2000/svg"),r(t,"class","stroke-current shrink-0 h-6 w-6"),r(t,"fill","none"),r(t,"viewBox","0 0 24 24"),r(e,"role","alert"),r(e,"class","alert bg-gradient-to-r to-[#fd1d1d] from-[#fcb045] !text-white")},m(l,s){V(l,e,s),c(e,t),c(t,a),c(e,n),c(e,o),c(o,d)},p(l,s){s&128&&Z(d,l[7])},d(l){l&&f(e)}}}function De(i){let e,t,a,n,o,d,l,s,m,y,w,k,D='<span class="text-white">Employee Name</span>',S,b,B,x,C,F='<span class="text-white">Transaction Amount</span>',U,E,q,u,A="Submit Transaction",H,L,P,v=i[7]&&ne(i);return{c(){e=p("div"),t=p("div"),a=p("p"),n=R("Influencer Email: "),o=R(i[2]),d=M(),l=p("p"),s=R("QR Code ID: "),m=R(i[3]),y=M(),w=p("div"),k=p("label"),k.innerHTML=D,S=M(),b=p("input"),B=M(),x=p("div"),C=p("label"),C.innerHTML=F,U=M(),E=p("input"),q=M(),u=p("button"),u.textContent=A,H=M(),v&&v.c(),this.h()},l(_){e=h(_,"DIV",{class:!0});var T=g(e);t=h(T,"DIV",{class:!0});var I=g(t);a=h(I,"P",{class:!0});var $=g(a);n=j($,"Influencer Email: "),o=j($,i[2]),$.forEach(f),d=N(I),l=h(I,"P",{class:!0});var ee=g(l);s=j(ee,"QR Code ID: "),m=j(ee,i[3]),ee.forEach(f),y=N(I),w=h(I,"DIV",{class:!0});var O=g(w);k=h(O,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),G(k)!=="svelte-1avw4ly"&&(k.innerHTML=D),S=N(O),b=h(O,"INPUT",{id:!0,type:!0,class:!0}),O.forEach(f),B=N(I),x=h(I,"DIV",{class:!0});var W=g(x);C=h(W,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),G(C)!=="svelte-12ukgw8"&&(C.innerHTML=F),U=N(W),E=h(W,"INPUT",{id:!0,type:!0,class:!0}),W.forEach(f),q=N(I),u=h(I,"BUTTON",{class:!0,"data-svelte-h":!0}),G(u)!=="svelte-11wxde2"&&(u.textContent=A),H=N(I),v&&v.l(I),I.forEach(f),T.forEach(f),this.h()},h(){r(a,"class","text-white font-bold mb-2"),r(l,"class","text-white font-bold mb-2"),r(k,"class","label"),r(k,"for","employeeName"),r(b,"id","employeeName"),r(b,"type","text"),r(b,"class","input input-bordered border-black text-white"),r(w,"class","form-control mb-4"),r(C,"class","label"),r(C,"for","transactionAmount"),r(E,"id","transactionAmount"),r(E,"type","number"),r(E,"class","input input-bordered border-black text-white"),r(x,"class","form-control mb-4"),r(u,"class","btn bg-gradient-to-r from-[#833ab4] from-10% via-[#fd1d1d] via-30% to-[#fcb045] to-90% !text-white !rounded-lg border-none w-full shadow-md"),r(t,"class","w-full max-w-md shadow-lg rounded-lg p-6 bg-black"),r(e,"class","bg-gradient-to-r from-[#833ab4] from-10% via-[#fd1d1d] via-30% to-[#fcb045] to-90% !text-white !rounded-lg border-none w-full min-w-[350px] max-w-md p-2")},m(_,T){V(_,e,T),c(e,t),c(t,a),c(a,n),c(a,o),c(t,d),c(t,l),c(l,s),c(l,m),c(t,y),c(t,w),c(w,k),c(w,S),c(w,b),Y(b,i[0]),c(t,B),c(t,x),c(x,C),c(x,U),c(x,E),Y(E,i[1]),c(t,q),c(t,u),c(t,H),v&&v.m(t,null),L||(P=[te(b,"input",i[12]),te(E,"input",i[13]),te(u,"click",i[11])],L=!0)},p(_,T){T&4&&Z(o,_[2]),T&8&&Z(m,_[3]),T&1&&b.value!==_[0]&&Y(b,_[0]),T&2&&oe(E.value)!==_[1]&&Y(E,_[1]),_[7]?v?v.p(_,T):(v=ne(_),v.c(),v.m(t,null)):v&&(v.d(1),v=null)},d(_){_&&f(e),v&&v.d(),L=!1,ue(P)}}}function ne(i){let e,t,a,n,o,d;return{c(){e=p("div"),t=K("svg"),a=K("path"),n=M(),o=p("span"),d=R(i[7]),this.h()},l(l){e=h(l,"DIV",{role:!0,class:!0});var s=g(e);t=X(s,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var m=g(t);a=X(m,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),g(a).forEach(f),m.forEach(f),n=N(s),o=h(s,"SPAN",{});var y=g(o);d=j(y,i[7]),y.forEach(f),s.forEach(f),this.h()},h(){r(a,"stroke-linecap","round"),r(a,"stroke-linejoin","round"),r(a,"stroke-width","2"),r(a,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),r(t,"xmlns","http://www.w3.org/2000/svg"),r(t,"class","stroke-current shrink-0 h-6 w-6"),r(t,"fill","none"),r(t,"viewBox","0 0 24 24"),r(e,"role","alert"),r(e,"class","alert bg-gradient-to-r to-[#fd1d1d] from-[#fcb045] !text-white")},m(l,s){V(l,e,s),c(e,t),c(t,a),c(e,n),c(e,o),c(o,d)},p(l,s){s&128&&Z(d,l[7])},d(l){l&&f(e)}}}function Ee(i){let e;function t(o,d){return o[5]?xe:o[4]?ke:we}let a=t(i),n=a(i);return{c(){e=p("div"),n.c(),this.h()},l(o){e=h(o,"DIV",{class:!0});var d=g(e);n.l(d),d.forEach(f),this.h()},h(){r(e,"class","p-8 bg-base-100 text-black min-h-screen flex flex-col items-center")},m(o,d){V(o,e,d),n.m(e,null)},p(o,[d]){a===(a=t(o))&&n?n.p(o,d):(n.d(1),n=a(o),n&&(n.c(),n.m(e,null)))},i:J,o:J,d(o){o&&f(e),n.d()}}}function Te(i,e,t){let a,n,o,d,l;Q(i,ge,u=>t(17,a=u)),Q(i,_e,u=>t(18,n=u));let s="",m="",y="",w="",k=ae(!1);Q(i,k,u=>t(6,d=u));let D=ae("");Q(i,D,u=>t(7,l=u));let S,b,B=!1,x=ae(!0);Q(i,x,u=>t(5,o=u));let C=!1;ce(async()=>{if(a.userType==="merchant")if(t(3,w=n.params.codeId),w){S=ve(re,"codes",w);try{const u=await le(S);if(u.exists()){b=u.data();const A=b.merchant.id;a.userRef.id===A?(C=!0,await F()):z("/app/campaigns")}else D.set("Invalid QR code."),z("/app/campaigns")}catch(u){console.error("Error fetching code document:",u),D.set("Error fetching code. Please try again."),z("/app/campaigns")}}else D.set("No code found."),z("/app/campaigns");else z("/app/campaigns")});async function F(){const u=new Date().getTime(),A=b.timestamp.toDate().getTime(),H=Number(b.promotionDuration),L=b.durationUnit;let P=!1;if(L==="days"?P=(u-A)/(1e3*60*60*24)<=H:L==="hours"&&(P=(u-A)/(1e3*60*60)<=H),P){const v=b.influencer,_=await le(v);if(_.exists()){const T=_.data();t(2,y=T.email),k.set(!0)}else D.set("Influencer data not found."),k.set(!1)}else D.set("This code is no longer valid."),k.set(!1);x.set(!1)}const U=async()=>{const u=parseFloat(m);if(!s.trim()||u<=0||isNaN(u)){D.set("All fields are required and the transaction amount must be a valid number.");return}x.set(!0);try{await me(pe(re,"transactions"),{codeId:w,code:S,influencer:b.influencer,employeeName:s,transactionAmount:u,merchant:a.userRef,timestamp:new Date}),await he(S,{usageCount:be(1)}),t(4,B=!0)}catch(A){console.error("Error submitting transaction:",A),D.set("Error submitting transaction. Please try again.")}finally{x.set(!1)}};function E(){s=this.value,t(0,s)}function q(){m=oe(this.value),t(1,m)}return[s,m,y,w,B,o,d,l,k,D,x,U,E,q]}class Be extends de{constructor(e){super(),fe(this,e,Te,Ee,ie,{})}}export{Be as component};
