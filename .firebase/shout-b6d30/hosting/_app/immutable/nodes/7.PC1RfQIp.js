import{s as se,n as X,c as Y,o as ae,r as ne}from"../chunks/scheduler.PCYk-eKx.js";import{S as le,i as oe,e as h,s as E,c as _,a as q,q as Q,f as N,d as T,p as c,g as j,h as o,w as te,t as x,b as L,j as S,y as H,r as G}from"../chunks/index.BWac97FB.js";import{a as Z,d as J,b as re,e as ie,c as ce,u as ue,i as de}from"../chunks/firebase.C7CWxqOX.js";import{w as $}from"../chunks/index.eg0ioKiZ.js";import{g as fe}from"../chunks/entry.D5liSSLQ.js";function me(n){let e,t;return{c(){e=h("p"),t=x(n[5]),this.h()},l(s){e=_(s,"P",{class:!0});var a=q(e);t=L(a,n[5]),a.forEach(T),this.h()},h(){c(e,"class","mt-4 text-red-600")},m(s,a){j(s,e,a),o(e,t)},p(s,a){a&32&&S(t,s[5])},d(s){s&&T(e)}}}function pe(n){let e,t,s,a,w,d,u,l,f,m,D,M='<span class="label-text text-black">Employee Name</span>',P,r,C,v,g,A='<span class="label-text text-black">Transaction Amount</span>',I,k,R,y,K="Submit Transaction",B,F,W,p=n[5]&&ee(n);return{c(){e=h("div"),t=h("p"),s=x("Influencer: "),a=x(n[2]),w=E(),d=h("p"),u=x("QR Code ID: "),l=x(n[3]),f=E(),m=h("div"),D=h("label"),D.innerHTML=M,P=E(),r=h("input"),C=E(),v=h("div"),g=h("label"),g.innerHTML=A,I=E(),k=h("input"),R=E(),y=h("button"),y.textContent=K,B=E(),p&&p.c(),this.h()},l(b){e=_(b,"DIV",{class:!0});var i=q(e);t=_(i,"P",{class:!0});var O=q(t);s=L(O,"Influencer: "),a=L(O,n[2]),O.forEach(T),w=N(i),d=_(i,"P",{class:!0});var z=q(d);u=L(z,"QR Code ID: "),l=L(z,n[3]),z.forEach(T),f=N(i),m=_(i,"DIV",{class:!0});var V=q(m);D=_(V,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),Q(D)!=="svelte-k3l84"&&(D.innerHTML=M),P=N(V),r=_(V,"INPUT",{id:!0,type:!0,class:!0}),V.forEach(T),C=N(i),v=_(i,"DIV",{class:!0});var U=q(v);g=_(U,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),Q(g)!=="svelte-6ecj5w"&&(g.innerHTML=A),I=N(U),k=_(U,"INPUT",{id:!0,type:!0,class:!0}),U.forEach(T),R=N(i),y=_(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Q(y)!=="svelte-1fiwydb"&&(y.textContent=K),B=N(i),p&&p.l(i),i.forEach(T),this.h()},h(){c(t,"class","text-black font-bold mb-2"),c(d,"class","text-black font-bold mb-2"),c(D,"class","label"),c(D,"for","employeeName"),c(r,"id","employeeName"),c(r,"type","text"),c(r,"class","input input-bordered border-black text-black"),c(m,"class","form-control mb-4"),c(g,"class","label"),c(g,"for","transactionAmount"),c(k,"id","transactionAmount"),c(k,"type","number"),c(k,"class","input input-bordered border-black text-black"),c(v,"class","form-control mb-4"),c(y,"class","btn btn-primary w-full shadow-md"),c(e,"class","w-full max-w-sm shadow-lg rounded-lg p-6 bg-white")},m(b,i){j(b,e,i),o(e,t),o(t,s),o(t,a),o(e,w),o(e,d),o(d,u),o(d,l),o(e,f),o(e,m),o(m,D),o(m,P),o(m,r),H(r,n[0]),o(e,C),o(e,v),o(v,g),o(v,I),o(v,k),H(k,n[1]),o(e,R),o(e,y),o(e,B),p&&p.m(e,null),F||(W=[G(r,"input",n[9]),G(k,"input",n[10]),G(y,"click",n[8])],F=!0)},p(b,i){i&4&&S(a,b[2]),i&8&&S(l,b[3]),i&1&&r.value!==b[0]&&H(r,b[0]),i&2&&te(k.value)!==b[1]&&H(k,b[1]),b[5]?p?p.p(b,i):(p=ee(b),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},d(b){b&&T(e),p&&p.d(),F=!1,ne(W)}}}function ee(n){let e,t;return{c(){e=h("p"),t=x(n[5]),this.h()},l(s){e=_(s,"P",{class:!0});var a=q(e);t=L(a,n[5]),a.forEach(T),this.h()},h(){c(e,"class","mt-4 text-red-600")},m(s,a){j(s,e,a),o(e,t)},p(s,a){a&32&&S(t,s[5])},d(s){s&&T(e)}}}function be(n){let e,t,s="Register Transaction",a;function w(l,f){return l[4]?pe:me}let d=w(n),u=d(n);return{c(){e=h("div"),t=h("h1"),t.textContent=s,a=E(),u.c(),this.h()},l(l){e=_(l,"DIV",{class:!0});var f=q(e);t=_(f,"H1",{class:!0,"data-svelte-h":!0}),Q(t)!=="svelte-uix1vj"&&(t.textContent=s),a=N(f),u.l(f),f.forEach(T),this.h()},h(){c(t,"class","text-3xl font-bold text-black mb-6"),c(e,"class","p-8 bg-base-100 text-black min-h-screen flex flex-col items-center")},m(l,f){j(l,e,f),o(e,t),o(e,a),u.m(e,null)},p(l,[f]){d===(d=w(l))&&u?u.p(l,f):(u.d(1),u=d(l),u&&(u.c(),u.m(e,null)))},i:X,o:X,d(l){l&&T(e),u.d()}}}function he(n,e,t){let s,a,w="",d="",u="",l="",f=$(!1);Y(n,f,r=>t(4,s=r));let m=$("");Y(n,m,r=>t(5,a=r)),ae(async()=>{const r=new URLSearchParams(window.location.search);if(t(3,l=r.get("qrcode")||""),console.log(l),l){console.log("Made it here ");const C=Z(J,"qrcodes",l),v=await re(C);if(v.exists()){const g=v.data(),A=new Date().getTime(),I=g.timestamp.toDate().getTime(),k=Number(g.promotionDuration),R=g.durationUnit;let y=!1;R==="days"?y=(A-I)/(1e3*60*60*24)<=k:R==="hours"&&(y=(A-I)/(1e3*60*60)<=k),y?(t(2,u=g.influencerName),f.set(!0)):m.set("This QR code is no longer valid.")}else m.set("Invalid QR code.")}else m.set("No QR code found.")});const D=async()=>{const r=parseFloat(d);if(!w.trim()||r<=0||isNaN(r)){m.set("All fields are required and the transaction amount must be a valid number.");return}try{const C=await ie(ce(J,"transactions"),{qrCodeId:l,influencerName:u,employeeName:w,transactionAmount:r,timestamp:new Date}),v=Z(J,"qrcodes",l);await ue(v,{usageCount:de(1)}),fe(`/success?transaction=${C.id}`)}catch(C){console.error("Error submitting transaction:",C),m.set("Error submitting transaction. Please try again.")}};function M(){w=this.value,t(0,w)}function P(){d=te(this.value),t(1,d)}return[w,d,u,l,s,a,f,m,D,M,P]}class ye extends le{constructor(e){super(),oe(this,e,he,be,se,{})}}export{ye as component};
